zed_config:
  cam_names: "[camera1,camera2,camera3]"
  cam_models: "[zed2i,zed2i,zed2i]"
  cam_serials: "[32514439,31718458,33289078]"  # Camera 1: Front, Camera 2: Rear, Camera 3: Manipulator
  disable_tf: "True"

  # Enable point cloud publishing for all cameras
  depth:
    depth_mode: "ULTRA"  # ULTRA or NEURAL for best quality
    point_cloud_freq: 15.0  # 15Hz point cloud publishing

  publish:
    depth:
      depth: true  # Enable depth map
      point_cloud: true  # Enable point cloud output
    rgb:
      image_rect_color: true  # Enable RGB rectified images (REQUIRED for RTAB-Map!)

launch_flags:
  rviz: false
  rtabmapviz: false
  multicamera_odom: true

rtabmap_params:
  # === Core RTAB-Map Settings ===
  frame_id: "camera1_left_camera_frame"
  subscribe_depth: false
  subscribe_rgb: false
  subscribe_stereo: false
  subscribe_rgbd: true  # TRUE = use RGBD interface
  subscribe_scan: false
  subscribe_scan_cloud: false
  subscribe_user_data: false
  subscribe_odom_info: false
  rgbd_cameras: 0  # 0 = use /rgbd_images topic (combined), not individual rgbd_image topics
  approx_sync: true

  # === Visual Odometry Settings ===
  Vis/EstimationType: "0"  # 0=3D->3D, 1=3D->2D (PnP)
  Vis/FeatureType: "6"  # 6=GFTT/BRIEF, 8=FAST/BRIEF, 9=ORB
  Vis/MaxFeatures: "400"  # Features per image
  Vis/MinInliers: "15"  # Minimum inliers to accept motion

  # === SLAM Settings ===
  RGBD/OptimizeFromGraphEnd: "false"
  RGBD/LoopClosureReextractFeatures: "true"
  Mem/IncrementalMemory: "true"
  Mem/InitWMWithAllNodes: "false"

  # === Point Cloud Settings (for 3D mapping) ===
  cloud_decimation: 4  # Reduce point cloud density (1=no decimation, 4=every 4th point)
  cloud_max_depth: 10.0  # Maximum depth in meters
  cloud_min_depth: 0.3  # Minimum depth in meters
  cloud_voxel_size: 0.05  # Voxel grid filter size (5cm) - reduces point cloud size
  cloud_floor_culling_height: 0.0  # Remove floor points below this height
  cloud_ceiling_culling_height: 2.5  # Remove ceiling points above this height

  # === 2D Grid Map Generation (THIS IS CRITICAL FOR COSTMAP) ===
  Proj/MaxGroundAngle: "45"  # Maximum ground angle (degrees)
  Proj/MinClusterSize: "20"  # Minimum cluster size
  Proj/MaxObstaclesHeight: "2.0"  # Only obstacles below 2m
  Proj/MaxGroundHeight: "0.1"  # Ground detection threshold
  Proj/DetectionRate: "1.0"  # Detection rate (Hz)
  Proj/MapFrameProjection: "true"  # Project in map frame

  # Grid settings
  GridGlobal/MinSize: "50.0"  # Minimum grid size (meters)
  GridGlobal/OccupancyThr: "0.5"  # Occupancy threshold
  GridGlobal/ProbHit: "0.7"  # Probability for hit
  GridGlobal/ProbMiss: "0.4"  # Probability for miss
  GridGlobal/UpdateError: "0.01"  # Update error threshold

  # === Map Publishing Settings ===
  publish_tf: true  # Publish map->odom transform
  map_frame_id: "map"  # Global map frame
  odom_frame_id: "odom"  # Odometry frame
  base_frame_id: "base_link"  # Robot base frame

  # === Optimization ===
  RGBD/ProximityBySpace: "true"
  RGBD/ProximityByTime: "false"
  RGBD/OptimizeMaxError: "3.0"  # Maximum optimization error

  # === Memory Management ===
  Rtabmap/DetectionRate: "1.0"  # Process every frame (1Hz = every 1 second, 0 = all frames)
  Rtabmap/TimeThr: "0"  # No time threshold for loop closure
  Kp/MaxFeatures: "400"  # Max features for loop closure detection

  # === Output Topics (will be created) ===
  # /rtabmap/grid_map - 2D occupancy grid (THIS FEEDS TO GLOBAL COSTMAP)
  # /rtabmap/cloud_map - 3D point cloud map
  # /rtabmap/proj_map - Projected 2D map
